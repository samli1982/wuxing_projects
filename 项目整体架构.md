# 五行项目 - 整体架构文档

## 项目概述

**项目名称**: 五行项目  
**项目类型**: 全栈应用（后端 + Web前端 + 微信小程序）  
**技术栈**: Spring Boot 3.2.0 + Vue 3 + 微信小程序

---

## 技术架构总览

```
┌─────────────────────────────────────────────────────────────┐
│                        客户端层                                │
├──────────────────────┬──────────────────────────────────────┤
│   Web管理端 (Vue3)     │    微信小程序端 (原生/uni-app)         │
│   - Element Plus      │    - 微信原生组件                      │
│   - Vue Router        │    - 微信登录授权                      │
│   - Pinia            │    - 位置服务                          │
│   - Axios            │    - 小程序支付                        │
└──────────────────────┴──────────────────────────────────────┘
                            ↓ HTTP/HTTPS
┌─────────────────────────────────────────────────────────────┐
│                     API网关层（可选）                          │
│   - Nginx反向代理                                             │
│   - 负载均衡                                                  │
│   - SSL证书                                                  │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                    后端服务层 (Spring Boot)                    │
├─────────────────────────────────────────────────────────────┤
│  Controller 层    →  Service 层  →  Mapper 层  →  Database   │
│  - 接口控制        - 业务逻辑      - 数据访问     - MySQL      │
│  - 参数验证        - 事务管理      - MyBatis-Plus - Redis     │
│  - JWT认证         - 缓存处理                                │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                       数据存储层                              │
├──────────────────────┬──────────────────────────────────────┤
│   MySQL 8.0          │    Redis 6.0                         │
│   - 关系型数据         │    - 缓存                            │
│   - 主数据存储         │    - Session                        │
│   - 事务支持          │    - 分布式锁                         │
└──────────────────────┴──────────────────────────────────────┘
```

---

## 项目目录结构

```
wuxing_projects/
│
├── backend/                           # 后端项目（Spring Boot）
│   ├── src/main/java/com/wuxing/
│   │   ├── config/                    # 配置类
│   │   ├── controller/                # 控制器（API接口）
│   │   ├── service/                   # 业务逻辑
│   │   ├── mapper/                    # 数据访问
│   │   ├── entity/                    # 数据库实体
│   │   ├── dto/                       # 数据传输对象
│   │   ├── exception/                 # 异常处理
│   │   └── utils/                     # 工具类
│   ├── src/main/resources/
│   │   ├── mapper/                    # MyBatis XML
│   │   ├── application.yml            # 配置文件
│   │   └── application-dev.yml
│   ├── sql/                           # SQL脚本
│   ├── docs/                          # 后端文档
│   └── pom.xml                        # Maven配置
│
├── frontend/                          # Web前端（Vue 3）
│   ├── src/
│   │   ├── api/                       # API接口封装
│   │   ├── assets/                    # 静态资源
│   │   ├── components/                # 公共组件
│   │   ├── views/                     # 页面视图
│   │   ├── router/                    # 路由配置
│   │   ├── store/                     # Pinia状态管理
│   │   ├── utils/                     # 工具函数
│   │   ├── App.vue                    # 根组件
│   │   └── main.js                    # 入口文件
│   ├── public/                        # 公共文件
│   ├── package.json                   # NPM配置
│   └── vite.config.js                 # Vite配置
│
├── miniprogram/                       # 微信小程序
│   ├── pages/                         # 页面
│   │   ├── index/                     # 首页
│   │   ├── mine/                      # 我的
│   │   ├── login/                     # 登录
│   │   └── ...
│   ├── components/                    # 组件
│   ├── utils/                         # 工具函数
│   ├── api/                           # API封装
│   ├── app.js                         # 入口文件
│   ├── app.json                       # 全局配置
│   └── project.config.json            # 项目配置
│
└── docs/                              # 项目文档
    ├── API接口文档.md
    ├── 数据库设计.md
    ├── 部署文档.md
    └── 开发规范.md
```

---

## 一、后端架构 (Spring Boot 3.2.0)

### 1.1 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Spring Boot | 3.2.0 | 核心框架 |
| Spring Security | 3.2.0 | 安全认证 |
| MyBatis-Plus | 3.5.5 | ORM框架 |
| MySQL | 8.0+ | 数据库 |
| Redis | 6.0+ | 缓存 |
| JWT | 0.12.3 | Token认证 |
| Knife4j | 4.4.0 | API文档 |
| Hutool | 5.8.24 | 工具类库 |

### 1.2 核心模块

#### 1.2.1 用户认证模块
- 用户注册/登录
- JWT Token生成与验证
- 微信小程序登录授权
- 权限控制

#### 1.2.2 业务功能模块
根据项目需求扩展，例如：
- 用户管理
- 角色权限管理
- 瑜伽课程管理
- 预约管理
- 订单管理
- 权益卡管理

#### 1.2.3 公共模块
- 统一响应结果封装
- 统一异常处理
- 日志记录
- 文件上传
- 短信/邮件服务

### 1.3 API设计规范

#### 请求规范
```
基础路径: /api/v1
管理端: /api/admin
小程序端: /api/app
```

#### 响应格式
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {},
  "timestamp": 1234567890
}
```

#### 状态码规范
- 200: 成功
- 400: 请求参数错误
- 401: 未授权
- 403: 禁止访问
- 404: 资源不存在
- 500: 服务器错误

---

## 二、Web前端架构 (Vue 3)

### 2.1 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Vue | 3.3+ | 核心框架 |
| Vite | 5.0+ | 构建工具 |
| Vue Router | 4.0+ | 路由管理 |
| Pinia | 2.1+ | 状态管理 |
| Element Plus | 2.4+ | UI组件库 |
| Axios | 1.6+ | HTTP客户端 |
| ECharts | 5.4+ | 图表库（可选） |

### 2.2 目录结构

```
frontend/src/
├── api/                    # API接口
│   ├── index.js           # API统一导出
│   ├── user.js            # 用户相关API
│   └── course.js          # 课程相关API
│
├── assets/                # 静态资源
│   ├── images/           # 图片
│   ├── styles/           # 样式
│   └── icons/            # 图标
│
├── components/            # 公共组件
│   ├── Layout/           # 布局组件
│   ├── Header/           # 头部组件
│   └── Table/            # 表格组件
│
├── views/                # 页面视图
│   ├── Home/             # 首页
│   ├── User/             # 用户管理
│   ├── Login/            # 登录页
│   └── Dashboard/        # 仪表盘
│
├── router/               # 路由
│   └── index.js
│
├── store/                # 状态管理
│   ├── modules/
│   │   ├── user.js      # 用户状态
│   │   └── app.js       # 应用状态
│   └── index.js
│
├── utils/                # 工具函数
│   ├── request.js       # Axios封装
│   ├── auth.js          # 认证工具
│   └── validate.js      # 验证工具
│
├── App.vue              # 根组件
└── main.js              # 入口文件
```

### 2.3 核心功能

#### 2.3.1 路由配置
- 路由守卫（权限验证）
- 动态路由加载
- 页面懒加载

#### 2.3.2 状态管理
- 用户信息管理
- Token管理
- 权限信息管理

#### 2.3.3 HTTP拦截器
- 请求拦截（添加Token）
- 响应拦截（统一错误处理）

---

## 三、微信小程序架构

### 3.1 技术栈

- **原生小程序开发** 或 **uni-app框架**
- 微信登录授权
- 微信支付
- 位置服务

### 3.2 目录结构

```
miniprogram/
├── pages/                    # 页面
│   ├── index/               # 首页（课程预约）
│   │   ├── index.js
│   │   ├── index.json
│   │   ├── index.wxml
│   │   └── index.wxss
│   ├── mine/                # 我的页面
│   ├── login/               # 登录页
│   ├── course/              # 课程详情
│   ├── order/               # 订单管理
│   └── card/                # 权益卡
│
├── components/              # 自定义组件
│   ├── course-card/        # 课程卡片
│   ├── date-selector/      # 日期选择器（横向滚动）
│   └── icon-grid/          # 图标网格（我的页面）
│
├── utils/                   # 工具函数
│   ├── request.js          # 网络请求封装
│   ├── auth.js             # 登录授权
│   └── location.js         # 位置服务
│
├── api/                     # API接口
│   ├── user.js
│   ├── course.js
│   └── order.js
│
├── app.js                   # 小程序入口
├── app.json                 # 全局配置
├── app.wxss                 # 全局样式
└── project.config.json      # 项目配置
```

### 3.3 核心功能设计

#### 3.3.1 登录流程
```
用户打开小程序
    ↓
检查本地Token
    ↓
无Token → 微信授权登录 → 获取openid → 后端验证 → 返回Token
    ↓
有Token → 验证Token有效性
    ↓
根据位置自动匹配所属门店
    ↓
进入首页
```

#### 3.3.2 首页设计
- **日期选择器**: 横向滚动，显示一周日期
- **课程列表**: 根据选择日期展示课程
- **预约功能**: 点击预约课程

#### 3.3.3 我的页面设计
```
┌─────────────────────────┐
│    头像    昵称          │
├─────────────────────────┤
│  【权益卡】【我的预约】   │  ← 置顶显示
│  【我的订单】             │
├─────────────────────────┤
│  [图标] [图标] [图标] [图标]  │  ← 网格布局
│  [文字] [文字] [文字] [文字]  │     每行4个
│  [图标] [图标] [图标] [图标]  │
│  [文字] [文字] [文字] [文字]  │
└─────────────────────────┘
```

---

## 四、数据库设计

### 4.1 核心表结构

#### 用户表 (sys_user)
```sql
- id: 主键
- username: 用户名
- password: 密码（加密）
- nickname: 昵称
- avatar: 头像
- openid: 微信openid
- phone: 手机号
- status: 状态
- create_time: 创建时间
```

#### 角色表 (sys_role)
```sql
- id: 主键
- role_name: 角色名称
- role_code: 角色编码
- description: 描述
```

#### 权限表 (sys_permission)
```sql
- id: 主键
- permission_name: 权限名称
- permission_code: 权限编码
- parent_id: 父权限ID
```

### 4.2 业务表（示例）

#### 课程表 (course)
```sql
- id: 主键
- course_name: 课程名称
- instructor: 教练
- start_time: 开始时间
- duration: 时长
- capacity: 容量
- store_id: 门店ID
```

#### 预约表 (booking)
```sql
- id: 主键
- user_id: 用户ID
- course_id: 课程ID
- status: 状态
- booking_time: 预约时间
```

---

## 五、接口设计规范

### 5.1 RESTful API规范

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /api/admin/users | 创建用户 |
| GET | /api/admin/users/:id | 获取用户详情 |
| GET | /api/admin/users | 获取用户列表 |
| PUT | /api/admin/users/:id | 更新用户 |
| DELETE | /api/admin/users/:id | 删除用户 |

### 5.2 小程序专用接口

| 接口 | 说明 |
|------|------|
| POST /api/app/auth/login | 微信登录 |
| GET /api/app/courses | 获取课程列表 |
| POST /api/app/bookings | 预约课程 |
| GET /api/app/user/info | 获取用户信息 |

---

## 六、开发规范

### 6.1 后端开发规范

1. **命名规范**
   - 类名: PascalCase (UserController)
   - 方法名: camelCase (getUserById)
   - 常量: UPPER_SNAKE_CASE (MAX_SIZE)

2. **注释规范**
   - 类注释: 说明类的功能
   - 方法注释: 说明参数、返回值、异常

3. **异常处理**
   - 使用统一异常处理器
   - 业务异常抛出BusinessException

### 6.2 前端开发规范

1. **组件命名**: PascalCase
2. **文件命名**: kebab-case
3. **变量命名**: camelCase
4. **常量命名**: UPPER_SNAKE_CASE

### 6.3 小程序开发规范

1. **页面路径**: 小写，用`-`分隔
2. **组件命名**: kebab-case
3. **API调用**: 统一使用封装的request方法

---

## 七、部署架构

### 7.1 开发环境
```
本地开发 → 本地MySQL/Redis → 本地调试
```

### 7.2 生产环境
```
┌──────────┐      ┌──────────┐      ┌──────────┐
│  Nginx   │ →    │  后端集群  │ →    │  MySQL   │
│ (80/443) │      │(负载均衡) │      │ (主从)    │
└──────────┘      └──────────┘      └──────────┘
                        ↓
                  ┌──────────┐
                  │  Redis   │
                  │ (哨兵)    │
                  └──────────┘
```

---

## 八、项目启动流程

### 8.1 后端启动
```bash
cd backend
mvn clean install
mvn spring-boot:run
```

### 8.2 前端启动
```bash
cd frontend
npm install
npm run dev
```

### 8.3 小程序启动
1. 使用微信开发者工具打开miniprogram目录
2. 配置AppID
3. 点击编译运行

---

## 九、版本管理

### 9.1 Git分支策略

- `main`: 主分支（生产环境）
- `develop`: 开发分支
- `feature/*`: 功能分支
- `hotfix/*`: 热修复分支

### 9.2 提交规范

```
feat: 新功能
fix: 修复bug
docs: 文档更新
style: 代码格式调整
refactor: 重构
test: 测试
chore: 构建/工具变动
```

---

## 十、安全考虑

1. **HTTPS**: 生产环境必须使用HTTPS
2. **XSS防护**: 前端输入过滤，后端输出转义
3. **CSRF防护**: Token验证
4. **SQL注入**: 使用参数化查询
5. **密码加密**: BCrypt加密
6. **敏感数据**: 环境变量配置，不提交到Git

---

## 十一、监控与日志

1. **日志收集**: 使用SLF4J + Logback
2. **异常监控**: 统一异常处理
3. **性能监控**: Spring Boot Actuator
4. **数据库监控**: Druid监控

---

## 附录

### A. 常用命令

```bash
# 后端
mvn clean package          # 打包
mvn spring-boot:run       # 运行

# 前端
npm run dev               # 开发
npm run build             # 打包

# Docker
docker-compose up -d      # 启动
docker-compose down       # 停止
```

### B. 环境变量配置

```bash
# 数据库
DB_HOST=localhost
DB_PORT=3306
DB_NAME=wuxing_db
DB_USER=root
DB_PASSWORD=

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379

# JWT
JWT_SECRET=your-secret-key
JWT_EXPIRATION=86400000
```

---

**文档版本**: v1.0  
**最后更新**: 2025-01-23  
**维护者**: 项目团队
