# æƒé™ç®¡ç†æ¥å£æƒé™æ§åˆ¶ä¿®å¤è¯´æ˜

## ğŸ› é—®é¢˜æè¿°

æƒé™ç®¡ç†æ¨¡å—çš„åˆ—è¡¨æ¥å£å’Œè¯¦æƒ…æ¥å£æ²¡æœ‰æ·»åŠ æƒé™éªŒè¯ï¼Œå¯¼è‡´å³ä½¿ç”¨æˆ·æ²¡æœ‰ `system:permission:list` æƒé™ï¼Œä»ç„¶å¯ä»¥è®¿é—®æƒé™åˆ—è¡¨ã€‚

### é—®é¢˜è¡¨ç°

1. **æƒé™åˆ—è¡¨æ¥å£** (`GET /api/permission/list`)
   - æ²¡æœ‰ `@RequiresPermission` æ³¨è§£
   - ä»»ä½•ç™»å½•ç”¨æˆ·éƒ½å¯ä»¥è®¿é—®
   - è¿åäº†æœ€å°æƒé™åŸåˆ™

2. **æƒé™è¯¦æƒ…æ¥å£** (`GET /api/permission/{id}`)
   - æ²¡æœ‰ `@RequiresPermission` æ³¨è§£
   - ä»»ä½•ç™»å½•ç”¨æˆ·éƒ½å¯ä»¥æŸ¥çœ‹æƒé™è¯¦æƒ…
   - å­˜åœ¨å®‰å…¨éšæ‚£

---

## âœ… ä¿®å¤å†…å®¹

### 1. æƒé™åˆ—è¡¨æ¥å£

**æ–‡ä»¶**: `/backend/src/main/java/com/wuxing/controller/PermissionController.java`

**ä¿®å¤å‰**:
```java
@Operation(summary = "æƒé™åˆ—è¡¨")
@GetMapping("/list")
public Result<IPage<Permission>> list(PageRequest request) {
    // ...
}
```

**ä¿®å¤å**:
```java
@Operation(summary = "æƒé™åˆ—è¡¨")
@GetMapping("/list")
@RequiresPermission("system:permission:list")  // âœ… æ·»åŠ æƒé™éªŒè¯
public Result<IPage<Permission>> list(PageRequest request) {
    // ...
}
```

**æƒé™è¦æ±‚**: `system:permission:list`

### 2. æƒé™è¯¦æƒ…æ¥å£

**ä¿®å¤å‰**:
```java
@Operation(summary = "æƒé™è¯¦æƒ…")
@GetMapping("/{id}")
public Result<Permission> getById(@PathVariable Long id) {
    // ...
}
```

**ä¿®å¤å**:
```java
@Operation(summary = "æƒé™è¯¦æƒ…")
@GetMapping("/{id}")
@RequiresPermission("system:permission:query")  // âœ… æ·»åŠ æƒé™éªŒè¯
public Result<Permission> getById(@PathVariable Long id) {
    // ...
}
```

**æƒé™è¦æ±‚**: `system:permission:query`

---

## ğŸ“Š å®Œæ•´çš„æƒé™ç®¡ç†æ¥å£åˆ—è¡¨

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | æƒé™ç¼–ç  | è¯´æ˜ |
|------|------|------|---------|------|
| æƒé™åˆ—è¡¨ | GET | `/api/permission/list` | `system:permission:list` | âœ… å·²ä¿®å¤ |
| æƒé™æ ‘ | GET | `/api/permission/tree` | æ—  | ç”¨äºæƒé™é€‰æ‹©å™¨ |
| æƒé™è¯¦æƒ… | GET | `/api/permission/{id}` | `system:permission:query` | âœ… å·²ä¿®å¤ |
| æ–°å¢æƒé™ | POST | `/api/permission` | `system:permission:add` | âœ… å·²æœ‰ |
| æ›´æ–°æƒé™ | PUT | `/api/permission/{id}` | `system:permission:edit` | âœ… å·²æœ‰ |
| åˆ é™¤æƒé™ | DELETE | `/api/permission/{id}` | `system:permission:delete` | âœ… å·²æœ‰ |
| è·å–è§’è‰²æƒé™ | GET | `/api/permission/role/{roleId}` | æ—  | ç”¨äºè§’è‰²ç®¡ç† |
| åˆ†é…æƒé™ç»™è§’è‰² | POST | `/api/permission/role/{roleId}` | `system:role:assign` | âœ… å·²æœ‰ |
| è·å–å½“å‰ç”¨æˆ·æƒé™ | GET | `/api/permission/current` | æ—  | ç™»å½•åè‡ªåŠ¨è°ƒç”¨ |

---

## ğŸ” æƒé™éªŒè¯æµç¨‹

### 1. ç”¨æˆ·è®¿é—®æƒé™åˆ—è¡¨

```
ç”¨æˆ·å‘èµ·è¯·æ±‚ GET /api/permission/list
    â†“
JWTè®¤è¯è¿‡æ»¤å™¨éªŒè¯Token
    â†“
PermissionAspectæ‹¦æˆªå™¨å¯åŠ¨
    â†“
æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰ system:permission:list æƒé™
    â†“
æœ‰æƒé™ â†’ ç»§ç»­æ‰§è¡Œ â†’ è¿”å›æ•°æ®
æ— æƒé™ â†’ æŠ›å‡ºå¼‚å¸¸ â†’ è¿”å›403
```

### 2. å‰åç«¯ååŒ

**å‰ç«¯æ§åˆ¶**:
- ä½¿ç”¨ `v-permission` æŒ‡ä»¤æ§åˆ¶æŒ‰é’®æ˜¾ç¤º
- æ²¡æœ‰æƒé™çš„æŒ‰é’®ä¸æ˜¾ç¤º

**åç«¯æ§åˆ¶**:
- ä½¿ç”¨ `@RequiresPermission` æ³¨è§£éªŒè¯æƒé™
- å³ä½¿ç»•è¿‡å‰ç«¯ï¼Œåç«¯ä¹Ÿä¼šæ‹’ç»è¯·æ±‚

**åŒé‡ä¿éšœ**:
- å‰ç«¯æå‡ç”¨æˆ·ä½“éªŒï¼ˆéšè—æ— æƒé™åŠŸèƒ½ï¼‰
- åç«¯ä¿è¯ç³»ç»Ÿå®‰å…¨ï¼ˆæ‹’ç»æ— æƒé™è®¿é—®ï¼‰

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•åœºæ™¯1: æœ‰å®Œæ•´æƒé™çš„ç”¨æˆ·

**ç”¨æˆ·**: adminï¼ˆè¶…çº§ç®¡ç†å‘˜ï¼‰

**æµ‹è¯•æ­¥éª¤**:
1. ç™»å½•ç³»ç»Ÿ
2. è¿›å…¥æƒé™ç®¡ç†é¡µé¢
3. æŸ¥çœ‹æƒé™åˆ—è¡¨

**é¢„æœŸç»“æœ**:
- âœ… å¯ä»¥çœ‹åˆ°æƒé™åˆ—è¡¨
- âœ… æ˜¾ç¤ºæ‰€æœ‰æ“ä½œæŒ‰é’®
- âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸ä½¿ç”¨

### æµ‹è¯•åœºæ™¯2: æ— æƒé™çš„ç”¨æˆ·

**ç”¨æˆ·**: åªæœ‰ `system:user` æƒé™çš„ç”¨æˆ·

**æµ‹è¯•æ­¥éª¤**:
1. ç™»å½•ç³»ç»Ÿ
2. å°è¯•ç›´æ¥è®¿é—® `/permission`
3. å°è¯•è°ƒç”¨ API

**é¢„æœŸç»“æœ**:
- âœ… å·¦ä¾§èœå•ä¸æ˜¾ç¤º"æƒé™ç®¡ç†"
- âœ… ç›´æ¥è®¿é—®URLä¼šè¢«æ‹¦æˆª
- âœ… APIè°ƒç”¨è¿”å›403é”™è¯¯

### æµ‹è¯•åœºæ™¯3: åªæœ‰æŸ¥è¯¢æƒé™çš„ç”¨æˆ·

**ç”¨æˆ·**: åªæœ‰ `system:permission:list` æƒé™çš„ç”¨æˆ·

**æµ‹è¯•æ­¥éª¤**:
1. ç™»å½•ç³»ç»Ÿ
2. è¿›å…¥æƒé™ç®¡ç†é¡µé¢
3. æŸ¥çœ‹æƒé™åˆ—è¡¨

**é¢„æœŸç»“æœ**:
- âœ… å¯ä»¥çœ‹åˆ°æƒé™åˆ—è¡¨
- âŒ ä¸æ˜¾ç¤º"æ–°å¢æƒé™"æŒ‰é’®
- âŒ ä¸æ˜¾ç¤º"ç¼–è¾‘"ã€"åˆ é™¤"æŒ‰é’®
- âœ… åªæ˜¾ç¤º"æŸ¥çœ‹"æŒ‰é’®ï¼ˆå¦‚æœæœ‰ `system:permission:query`ï¼‰

### APIæµ‹è¯•

```bash
# 1. ç™»å½•è·å–Token
TOKEN=$(curl -s -X POST http://localhost:8080/api/user/login \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","password":"password"}' \
  | grep -o '"token":"[^"]*' | cut -d'"' -f4)

# 2. æµ‹è¯•æƒé™åˆ—è¡¨æ¥å£ï¼ˆæ— æƒé™ï¼‰
curl -X GET "http://localhost:8080/api/permission/list?current=1&size=10" \
  -H "Authorization: Bearer $TOKEN"

# é¢„æœŸè¿”å›: 403 Forbidden æˆ–æƒé™ä¸è¶³çš„é”™è¯¯æç¤º
```

---

## ğŸ“ ä¸ºä»€ä¹ˆè¦åŒæ—¶æ§åˆ¶å‰åç«¯

### åªæ§åˆ¶å‰ç«¯çš„é—®é¢˜

âŒ **å‰ç«¯æ§åˆ¶å¯ä»¥è¢«ç»•è¿‡**:
- ç”¨æˆ·å¯ä»¥é€šè¿‡æµè§ˆå™¨å¼€å‘å·¥å…·ä¿®æ”¹ä»£ç 
- å¯ä»¥ç›´æ¥è°ƒç”¨APIæ¥å£
- å¯ä»¥ä½¿ç”¨Postmanç­‰å·¥å…·ç»•è¿‡å‰ç«¯

### åªæ§åˆ¶åç«¯çš„é—®é¢˜

âŒ **ç”¨æˆ·ä½“éªŒå·®**:
- ç”¨æˆ·ä¼šçœ‹åˆ°æ‰€æœ‰æŒ‰é’®
- ç‚¹å‡»åæ‰å‘ç°æ²¡æœ‰æƒé™
- å¢åŠ ä¸å¿…è¦çš„é”™è¯¯æç¤º

### åŒé‡æ§åˆ¶çš„ä¼˜åŠ¿

âœ… **å®‰å…¨æ€§**: åç«¯éªŒè¯ä¿è¯ç³»ç»Ÿå®‰å…¨
âœ… **ç”¨æˆ·ä½“éªŒ**: å‰ç«¯æ§åˆ¶éšè—æ— æƒé™åŠŸèƒ½
âœ… **æ¸…æ™°æ˜ç¡®**: ç”¨æˆ·çŸ¥é“è‡ªå·±èƒ½åšä»€ä¹ˆ
âœ… **é˜²å¾¡æ·±åº¦**: å¤šå±‚é˜²æŠ¤æ›´å®‰å…¨

---

## ğŸ”„ å…¶ä»–æ¨¡å—çš„æƒé™æ§åˆ¶

### ç”¨æˆ·ç®¡ç†
| æ¥å£ | æƒé™ |
|------|------|
| ç”¨æˆ·åˆ—è¡¨ | `system:user:list` |
| ç”¨æˆ·è¯¦æƒ… | `system:user:query` |
| æ–°å¢ç”¨æˆ· | `system:user:add` |
| æ›´æ–°ç”¨æˆ· | `system:user:edit` |
| åˆ é™¤ç”¨æˆ· | `system:user:delete` |

### è§’è‰²ç®¡ç†
| æ¥å£ | æƒé™ |
|------|------|
| è§’è‰²åˆ—è¡¨ | `system:role:list` |
| è§’è‰²è¯¦æƒ… | `system:role:query` |
| æ–°å¢è§’è‰² | `system:role:add` |
| æ›´æ–°è§’è‰² | `system:role:edit` |
| åˆ é™¤è§’è‰² | `system:role:delete` |
| åˆ†é…æƒé™ | `system:role:assign` |

---

## âœ… ä¿®å¤æ€»ç»“

**ä¿®æ”¹æ–‡ä»¶**:
- `/backend/src/main/java/com/wuxing/controller/PermissionController.java`

**ä¿®æ”¹å†…å®¹**:
- ä¸º `list()` æ–¹æ³•æ·»åŠ  `@RequiresPermission("system:permission:list")`
- ä¸º `getById()` æ–¹æ³•æ·»åŠ  `@RequiresPermission("system:permission:query")`

**å½±å“èŒƒå›´**:
- æ— æƒé™ç”¨æˆ·æ— æ³•è®¿é—®æƒé™åˆ—è¡¨
- æ— æƒé™ç”¨æˆ·æ— æ³•æŸ¥çœ‹æƒé™è¯¦æƒ…
- æå‡ç³»ç»Ÿå®‰å…¨æ€§

**å…¼å®¹æ€§**:
- âœ… ä¸å½±å“æœ‰æƒé™çš„ç”¨æˆ·
- âœ… å‘åå…¼å®¹
- âœ… ç¬¦åˆRBACè§„èŒƒ

---

## ğŸ‰ ä¿®å¤å®Œæˆ

ç°åœ¨æƒé™ç®¡ç†æ¨¡å—çš„æ‰€æœ‰æ¥å£éƒ½å·²ç»æ·»åŠ äº†æƒé™éªŒè¯ï¼š

âœ… æƒé™åˆ—è¡¨ - `system:permission:list`
âœ… æƒé™è¯¦æƒ… - `system:permission:query`
âœ… æ–°å¢æƒé™ - `system:permission:add`
âœ… ç¼–è¾‘æƒé™ - `system:permission:edit`
âœ… åˆ é™¤æƒé™ - `system:permission:delete`

**é‡å¯åç«¯æœåŠ¡åï¼Œæƒé™æ§åˆ¶å³å¯ç”Ÿæ•ˆï¼**
