# å‰ç«¯æƒé™ç®¡ç†æ¨¡å—å®ç°è¯´æ˜

## âœ… å·²å®ç°åŠŸèƒ½

### 1. æƒé™ç®¡ç†é¡µé¢

#### 1.1 é¡µé¢è·¯å¾„
- **URL**: `/permission`
- **ç»„ä»¶**: `/frontend/src/views/permission/index.vue`
- **èœå•**: å·²æ·»åŠ åˆ°ä¾§è¾¹æ ï¼ˆé”å›¾æ ‡ï¼‰

#### 1.2 åŠŸèƒ½åˆ—è¡¨
- âœ… æƒé™åˆ—è¡¨å±•ç¤ºï¼ˆæ ‘å½¢ç»“æ„ï¼‰
- âœ… æƒé™æœç´¢ï¼ˆæŒ‰åç§°ã€ç±»å‹ï¼‰
- âœ… æ–°å¢æƒé™
- âœ… ç¼–è¾‘æƒé™
- âœ… åˆ é™¤æƒé™
- âœ… æŸ¥çœ‹æƒé™è¯¦æƒ…
- âœ… æƒé™ç±»å‹æ ‡è¯†ï¼ˆèœå•/æŒ‰é’®ï¼‰
- âœ… çŠ¶æ€ç®¡ç†ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰
- âœ… çˆ¶å­æƒé™å…³ç³»ï¼ˆæ ‘å½¢é€‰æ‹©å™¨ï¼‰

### 2. è§’è‰²æƒé™åˆ†é…

#### 2.1 åŠŸèƒ½å…¥å£
åœ¨è§’è‰²ç®¡ç†é¡µé¢ï¼Œæ¯ä¸ªè§’è‰²éƒ½æœ‰"åˆ†é…æƒé™"æŒ‰é’®

#### 2.2 åŠŸèƒ½ç‰¹æ€§
- âœ… æ ‘å½¢æƒé™é€‰æ‹©å™¨
- âœ… æ˜¾ç¤ºè§’è‰²å·²æœ‰æƒé™ï¼ˆè‡ªåŠ¨å‹¾é€‰ï¼‰
- âœ… æ”¯æŒå…¨é€‰/éƒ¨åˆ†é€‰æ‹©
- âœ… è‡ªåŠ¨åŒ…å«åŠé€‰ä¸­çš„çˆ¶èŠ‚ç‚¹
- âœ… å®æ—¶ä¿å­˜æƒé™åˆ†é…

### 3. å‰ç«¯æƒé™æ§åˆ¶

#### 3.1 æƒé™Store
**æ–‡ä»¶**: `/frontend/src/stores/permission.js`

**åŠŸèƒ½**:
- å­˜å‚¨å½“å‰ç”¨æˆ·çš„æƒé™åˆ—è¡¨
- æä¾›æƒé™æ£€æŸ¥æ–¹æ³•
- æ‡’åŠ è½½æƒé™æ•°æ®

**ä½¿ç”¨æ–¹æ³•**:
```javascript
import { usePermissionStore } from '@/stores/permission'

const permissionStore = usePermissionStore()

// åŠ è½½æƒé™
await permissionStore.loadPermissions()

// æ£€æŸ¥å•ä¸ªæƒé™
const hasAdd = permissionStore.hasPermission('system:user:add')

// æ£€æŸ¥å¤šä¸ªæƒé™ï¼ˆä»»ä¸€ï¼‰
const hasAny = permissionStore.hasAnyPermission(['system:user:add', 'system:user:edit'])

// æ£€æŸ¥å¤šä¸ªæƒé™ï¼ˆå…¨éƒ¨ï¼‰
const hasAll = permissionStore.hasAllPermissions(['system:user:add', 'system:user:edit'])
```

#### 3.2 æƒé™æŒ‡ä»¤
**æ–‡ä»¶**: `/frontend/src/directives/permission.js`

**v-permission æŒ‡ä»¤**ï¼ˆæ‹¥æœ‰ä»»ä¸€æƒé™å³å¯ï¼‰:
```vue
<!-- å•ä¸ªæƒé™ -->
<el-button v-permission="'system:user:add'">æ–°å¢</el-button>

<!-- å¤šä¸ªæƒé™ï¼ˆä»»ä¸€ï¼‰ -->
<el-button v-permission="['system:user:add', 'system:user:edit']">æ“ä½œ</el-button>
```

**v-permission-all æŒ‡ä»¤**ï¼ˆéœ€è¦å…¨éƒ¨æƒé™ï¼‰:
```vue
<!-- å¿…é¡»åŒæ—¶æ‹¥æœ‰ä¸¤ä¸ªæƒé™ -->
<el-button v-permission-all="['system:user:add', 'system:user:edit']">é«˜çº§æ“ä½œ</el-button>
```

### 4. å·²åº”ç”¨æƒé™æ§åˆ¶çš„é¡µé¢

#### 4.1 ç”¨æˆ·ç®¡ç†é¡µé¢
```vue
<!-- æ–°å¢æŒ‰é’® -->
<el-button v-permission="'system:user:add'">æ–°å¢ç”¨æˆ·</el-button>

<!-- æŸ¥çœ‹æŒ‰é’® -->
<el-button v-permission="'system:user:query'">æŸ¥çœ‹</el-button>

<!-- ç¼–è¾‘æŒ‰é’® -->
<el-button v-permission="'system:user:edit'">ç¼–è¾‘</el-button>

<!-- åˆ é™¤æŒ‰é’® -->
<el-button v-permission="'system:user:delete'">åˆ é™¤</el-button>
```

#### 4.2 è§’è‰²ç®¡ç†é¡µé¢
```vue
<!-- æ–°å¢æŒ‰é’® -->
<el-button v-permission="'system:role:add'">æ–°å¢è§’è‰²</el-button>

<!-- æŸ¥çœ‹æŒ‰é’® -->
<el-button v-permission="'system:role:query'">æŸ¥çœ‹</el-button>

<!-- ç¼–è¾‘æŒ‰é’® -->
<el-button v-permission="'system:role:edit'">ç¼–è¾‘</el-button>

<!-- åˆ é™¤æŒ‰é’® -->
<el-button v-permission="'system:role:delete'">åˆ é™¤</el-button>

<!-- åˆ†é…æƒé™æŒ‰é’® -->
<el-button v-permission="'system:role:assign'">åˆ†é…æƒé™</el-button>
```

---

## ğŸ“ æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
1. `/frontend/src/api/permission.js` - æƒé™APIæ¥å£
2. `/frontend/src/views/permission/index.vue` - æƒé™ç®¡ç†é¡µé¢
3. `/frontend/src/stores/permission.js` - æƒé™çŠ¶æ€ç®¡ç†
4. `/frontend/src/directives/permission.js` - æƒé™æŒ‡ä»¤

### ä¿®æ”¹æ–‡ä»¶
1. `/frontend/src/router/index.js` - æ·»åŠ æƒé™ç®¡ç†è·¯ç”±
2. `/frontend/src/layout/index.vue` - æ·»åŠ æƒé™ç®¡ç†èœå•
3. `/frontend/src/main.js` - æ³¨å†Œæƒé™æŒ‡ä»¤
4. `/frontend/src/views/role/index.vue` - æ·»åŠ æƒé™åˆ†é…åŠŸèƒ½
5. `/frontend/src/views/user/index.vue` - æ·»åŠ æƒé™æ§åˆ¶
6. `/frontend/src/views/role/index.vue` - æ·»åŠ æƒé™æ§åˆ¶

---

## ğŸ¯ ä½¿ç”¨æŒ‡å—

### 1. è®¿é—®æƒé™ç®¡ç†

1. ç™»å½•ç³»ç»Ÿï¼ˆä½¿ç”¨ admin/admin123ï¼‰
2. ç‚¹å‡»å·¦ä¾§èœå•"æƒé™ç®¡ç†"
3. å¯ä»¥çœ‹åˆ°æ‰€æœ‰æƒé™çš„æ ‘å½¢ç»“æ„

### 2. æ–°å¢æƒé™

1. ç‚¹å‡»"æ–°å¢æƒé™"æŒ‰é’®
2. å¡«å†™æƒé™ä¿¡æ¯ï¼š
   - **æƒé™åç§°**: å¦‚"ç”¨æˆ·å¯¼å‡º"
   - **æƒé™ç¼–ç **: å¦‚"system:user:export"ï¼ˆéµå¾ª æ¨¡å—:åŠŸèƒ½:æ“ä½œ æ ¼å¼ï¼‰
   - **æƒé™ç±»å‹**: é€‰æ‹©"èœå•"æˆ–"æŒ‰é’®"
   - **çˆ¶çº§æƒé™**: å¯é€‰ï¼Œç”¨äºå»ºç«‹å±‚çº§å…³ç³»
   - **è·¯ç”±åœ°å€**: èœå•ç±»å‹æ—¶å¡«å†™
   - **å›¾æ ‡**: èœå•ç±»å‹æ—¶å¡«å†™
   - **æ’åº**: æ•°å­—ï¼Œè¶Šå°è¶Šé å‰
   - **çŠ¶æ€**: å¯ç”¨/ç¦ç”¨
3. ç‚¹å‡»"ç¡®å®š"ä¿å­˜

### 3. ä¸ºè§’è‰²åˆ†é…æƒé™

1. è¿›å…¥"è§’è‰²ç®¡ç†"é¡µé¢
2. ç‚¹å‡»æŸä¸ªè§’è‰²çš„"åˆ†é…æƒé™"æŒ‰é’®
3. åœ¨æƒé™æ ‘ä¸­å‹¾é€‰éœ€è¦çš„æƒé™
4. ç‚¹å‡»"ç¡®å®š"ä¿å­˜

### 4. åœ¨ä»£ç ä¸­ä½¿ç”¨æƒé™æ§åˆ¶

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨æŒ‡ä»¤
```vue
<template>
  <!-- éšè—æ²¡æœ‰æƒé™çš„æŒ‰é’® -->
  <el-button v-permission="'system:user:add'" @click="handleAdd">
    æ–°å¢
  </el-button>
</template>
```

#### æ–¹æ³•äºŒï¼šä½¿ç”¨Store
```vue
<script setup>
import { usePermissionStore } from '@/stores/permission'

const permissionStore = usePermissionStore()

// åœ¨æ–¹æ³•ä¸­åˆ¤æ–­
const handleOperation = () => {
  if (!permissionStore.hasPermission('system:user:delete')) {
    ElMessage.error('æ²¡æœ‰åˆ é™¤æƒé™')
    return
  }
  // æ‰§è¡Œåˆ é™¤æ“ä½œ
}
</script>
```

#### æ–¹æ³•ä¸‰ï¼šåœ¨æ¨¡æ¿ä¸­ç›´æ¥åˆ¤æ–­
```vue
<template>
  <div v-if="permissionStore.hasPermission('system:user:add')">
    <p>ä½ æœ‰æ–°å¢æƒé™</p>
  </div>
</template>

<script setup>
import { usePermissionStore } from '@/stores/permission'
const permissionStore = usePermissionStore()
</script>
```

---

## ğŸ”§ æƒé™ç¼–ç è§„èŒƒ

### å‘½åæ ¼å¼
**æ¨¡å—:åŠŸèƒ½:æ“ä½œ**

### ç¤ºä¾‹
```
system:user:query       # ç”¨æˆ·æŸ¥è¯¢
system:user:list        # ç”¨æˆ·åˆ—è¡¨  
system:user:add         # æ–°å¢ç”¨æˆ·
system:user:edit        # ç¼–è¾‘ç”¨æˆ·
system:user:delete      # åˆ é™¤ç”¨æˆ·
system:user:export      # å¯¼å‡ºç”¨æˆ·
system:user:import      # å¯¼å…¥ç”¨æˆ·
```

### å¸¸ç”¨æ“ä½œ
- `query` - æŸ¥è¯¢å•ä¸ª
- `list` - åˆ—è¡¨æŸ¥è¯¢
- `add` - æ–°å¢
- `edit` - ç¼–è¾‘
- `delete` - åˆ é™¤
- `export` - å¯¼å‡º
- `import` - å¯¼å…¥
- `assign` - åˆ†é…
- `reset` - é‡ç½®

---

## ğŸ¨ ç•Œé¢é¢„è§ˆ

### æƒé™ç®¡ç†é¡µé¢
- æ ‘å½¢è¡¨æ ¼å±•ç¤ºæƒé™å±‚çº§
- æƒé™ç±»å‹æ ‡ç­¾ï¼ˆèœå•/æŒ‰é’®ï¼‰
- çŠ¶æ€æ ‡ç­¾ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰
- æ“ä½œæŒ‰é’®ï¼ˆæŸ¥çœ‹/ç¼–è¾‘/åˆ é™¤ï¼‰

### æ–°å¢/ç¼–è¾‘æƒé™
- æƒé™åŸºæœ¬ä¿¡æ¯è¡¨å•
- çˆ¶çº§æƒé™æ ‘å½¢é€‰æ‹©å™¨
- æƒé™ç±»å‹åˆ‡æ¢ï¼ˆå½±å“æ˜¾ç¤ºå­—æ®µï¼‰

### åˆ†é…æƒé™
- æ ‘å½¢æƒé™é€‰æ‹©å™¨
- è‡ªåŠ¨å‹¾é€‰å·²æœ‰æƒé™
- æ”¯æŒå…¨é€‰/å±•å¼€/æŠ˜å 

---

## ğŸ’¡ é«˜çº§ç”¨æ³•

### 1. åŠ¨æ€èœå•ï¼ˆåŸºäºæƒé™ï¼‰

å¯ä»¥æ ¹æ®ç”¨æˆ·æƒé™åŠ¨æ€ç”Ÿæˆèœå•ï¼š

```javascript
import { usePermissionStore } from '@/stores/permission'

const generateMenus = () => {
  const permissionStore = usePermissionStore()
  const menuPermissions = permissionStore.menuPermissions
  
  // æ ¹æ®èœå•æƒé™ç”Ÿæˆè·¯ç”±
  return menuPermissions.map(menu => ({
    path: menu.path,
    name: menu.permissionCode,
    meta: {
      title: menu.permissionName,
      icon: menu.icon
    }
  }))
}
```

### 2. è·¯ç”±å®ˆå«æƒé™éªŒè¯

```javascript
// router/index.js
router.beforeEach((to, from, next) => {
  const permissionStore = usePermissionStore()
  
  // æ£€æŸ¥è·¯ç”±æ˜¯å¦éœ€è¦æƒé™
  if (to.meta.permission) {
    if (!permissionStore.hasPermission(to.meta.permission)) {
      ElMessage.error('æ²¡æœ‰è®¿é—®æƒé™')
      next(from.path)
      return
    }
  }
  
  next()
})
```

### 3. æŒ‰é’®æƒé™æ‰¹é‡æ§åˆ¶

```vue
<template>
  <div class="action-buttons">
    <el-button
      v-for="btn in actionButtons"
      :key="btn.code"
      :type="btn.type"
      @click="btn.handler"
    >
      {{ btn.label }}
    </el-button>
  </div>
</template>

<script setup>
import { computed } from 'vue'
import { usePermissionStore } from '@/stores/permission'

const permissionStore = usePermissionStore()

const allButtons = [
  { code: 'system:user:add', label: 'æ–°å¢', type: 'primary', handler: handleAdd },
  { code: 'system:user:edit', label: 'ç¼–è¾‘', type: 'warning', handler: handleEdit },
  { code: 'system:user:delete', label: 'åˆ é™¤', type: 'danger', handler: handleDelete }
]

// è¿‡æ»¤å‡ºæœ‰æƒé™çš„æŒ‰é’®
const actionButtons = computed(() => {
  return allButtons.filter(btn => permissionStore.hasPermission(btn.code))
})
</script>
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å‰åç«¯åŒé‡éªŒè¯**
   - å‰ç«¯æƒé™æ§åˆ¶åªæ˜¯UIå±‚é¢ï¼Œä¸èƒ½ä¿è¯å®‰å…¨
   - åç«¯å¿…é¡»ä½¿ç”¨ `@RequiresPermission` æ³¨è§£è¿›è¡ŒéªŒè¯
   
2. **æƒé™åŠ è½½æ—¶æœº**
   - å»ºè®®åœ¨ç”¨æˆ·ç™»å½•æˆåŠŸåç«‹å³åŠ è½½æƒé™
   - å¯ä»¥åœ¨è·¯ç”±å®ˆå«ä¸­æ£€æŸ¥æƒé™æ˜¯å¦å·²åŠ è½½

3. **æƒé™ç¼“å­˜**
   - æƒé™æ•°æ®é»˜è®¤ç¼“å­˜åœ¨å†…å­˜ä¸­
   - é€€å‡ºç™»å½•æ—¶éœ€è¦æ¸…é™¤æƒé™ç¼“å­˜

4. **æƒé™æ›´æ–°**
   - ç®¡ç†å‘˜ä¿®æ”¹ç”¨æˆ·è§’è‰²åï¼Œç”¨æˆ·éœ€è¦é‡æ–°ç™»å½•æ‰èƒ½è·å–æ–°æƒé™
   - æˆ–è€…æä¾›"åˆ·æ–°æƒé™"åŠŸèƒ½

---

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

1. â³ æƒé™ç¼“å­˜åˆ° localStorage
2. â³ æƒé™å˜æ›´å®æ—¶é€šçŸ¥ï¼ˆWebSocketï¼‰
3. â³ æƒé™æ ‘æ”¯æŒæ‹–æ‹½æ’åº
4. â³ æƒé™æ‰¹é‡æ“ä½œï¼ˆæ‰¹é‡å¯ç”¨/ç¦ç”¨ï¼‰
5. â³ æƒé™å¯¼å…¥å¯¼å‡º
6. â³ æƒé™ä½¿ç”¨ç»Ÿè®¡
7. â³ æƒé™å®¡è®¡æ—¥å¿—

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [åç«¯æƒé™ç®¡æ§ç³»ç»Ÿè¯´æ˜](/Users/saml/GoProjects/src/wuxing_projects/æƒé™ç®¡æ§ç³»ç»Ÿè¯´æ˜.md)
- [APIå¯¹æ¥è¯´æ˜](/Users/saml/GoProjects/src/wuxing_projects/APIå¯¹æ¥è¯´æ˜.md)
