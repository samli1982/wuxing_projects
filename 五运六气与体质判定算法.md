# 五运六气与体质判定算法详解

## 第一部分：五运六气系统

### 一、基本概念

**五运六气**是中医最高等级的预测理论，用于预测该年度的气候特征和疾病高发趋势。

| 术语 | 定义 |
|------|------|
| **五运** | 根据天干推算的该年度主运气（木火土金水） |
| **六气** | 根据地支推算的该年度的六种气候特征 |
| **司天** | 该年上半年（1月-6月）主导的气学特征 |
| **在泉** | 该年下半年（7月-12月）主导的气学特征 |

### 二、五运计算原理（天干规律）

#### 2.1 五运与天干对应

采用**"干支五子运"理论**，根据公历年份的天干推算：

```
甲己之岁 → 土运元
乙庚之岁 → 金运先
丙辛之岁 → 水运流
丁壬之岁 → 木运荣
戊癸之岁 → 火运动
```

**记忆方法**：
- `甲己` 对应 `土` → 5个数字都是`5`的倍数（5, 10, 15...）
- `乙庚` 对应 `金` → 成对的差`5`（1与6、2与7...）
- `丙辛` 对应 `水` → 成对的差`5`
- `丁壬` 对应 `木` → 成对的差`5`
- `戊癸` 对应 `火` → 成对的差`5`

#### 2.2 五运太过与不及

同一五行的两个天干会表现出不同的强度：

| 天干 | 五行 | 运气 | 解释 |
|------|------|------|------|
| 甲 | 土 | **土运太过** | 土行力量强，易陷，易食积 |
| 己 | 土 | **土运不及** | 土行力量弱，脾虚弱 |
| 乙 | 金 | **金运不及** | 金行力量弱，肺气不足 |
| 庚 | 金 | **金运太过** | 金行力量强，易感冒 |
| 丙 | 水 | **水运太过** | 水行力量强，易腹泻 |
| 辛 | 水 | **水运不及** | 水行力量弱，肾阳不足 |
| 丁 | 木 | **木运不及** | 木行力量弱，肝血不足 |
| 壬 | 木 | **木运太过** | 木行力量强，易木旺 |
| 戊 | 火 | **火运太过** | 火行力量强，易心烦 |
| 癸 | 火 | **火运不及** | 火行力量弱，阳气不足 |

**示例**：
- 2024年是甲辰年 → 甲对应土运太过 → 该年易发生脾胃疾病、湿气困脾
- 2025年是乙巳年 → 乙对应金运不及 → 该年易发生呼吸道疾病

### 三、六气计算原理（地支规律）

#### 3.1 六气与司天在泉

按照地支推算该年上下半年的气候主导者。六气分为：

| 序号 | 六气名称 | 五行属性 | 特征 |
|------|--------|--------|------|
| 1 | **厥阴风木** | 木 | 春气，风木上升，木气生发 |
| 2 | **少阴君火** | 火 | 初夏，火气炽热，心火旺盛 |
| 3 | **太阴湿土** | 土 | 长夏，湿气弥漫，脾胃困顿 |
| 4 | **少阳相火** | 火 | 夏末秋初，相火浮腾 |
| 5 | **阳明燥金** | 金 | 秋气，燥气伤肺，津液干涸 |
| 6 | **太阳寒水** | 水 | 冬气，寒冷凝聚，阳气内守 |

#### 3.2 司天在泉与年份对应

根据**年份 mod 10**确定该年的六气组合：

```java
int mod = year % 10;
String[][] siTianZaiQuan = {
    {"厥阴风木", "少阳相火"},    // 0 - 尾数为0 (1980, 1990, 2000...)
    {"少阴君火", "太阴湿土"},    // 1 - 尾数为1 (1981, 1991, 2001...)
    {"太阴湿土", "少阳相火"},    // 2 - 尾数为2 (1982, 1992, 2002...)
    {"少阳相火", "厥阴风木"},    // 3 - 尾数为3 (1983, 1993, 2003...)
    {"太阳寒水", "太阴湿土"},    // 4 - 尾数为4 (1984, 1994, 2004...)
    {"厥阴风木", "少阴君火"},    // 5 - 尾数为5 (1985, 1995, 2005...)
    {"少阴君火", "太阳寒水"},    // 6 - 尾数为6 (1986, 1996, 2006...)
    {"太阴湿土", "厥阴风木"},    // 7 - 尾数为7 (1987, 1997, 2007...)
    {"少阳相火", "太阴湿土"},    // 8 - 尾数为8 (1988, 1998, 2008...)
    {"太阳寒水", "少阳相火"}     // 9 - 尾数为9 (1989, 1999, 2009...)
};
```

### 四、气候特征生成

根据**司天**推断该年上半年的气候和健康影响：

| 司天 | 气候特征 | 健康影响 |
|------|---------|---------|
| **火** | 上半年火热偏盛，气候炎热 | 易中暑、心烦、口渴、便秘 |
| **水** | 上半年寒凉潮湿，易伤阳气 | 易腹泻、四肢冷、关节酸软 |
| **木** | 上半年风气主令，易动肝阳 | 易头晕、目赤、情绪波动 |
| **土** | 上半年湿土太过，易困脾胃 | 易腹胀、大便不爽、四肢困重 |
| **金** | 上半年燥金之气，易伤肺津 | 易干咳、喉干、皮肤干燥 |

### 五、健康提示生成

#### 5.1 上半年提示（司天）

```java
if (tiansi.contains("火")) {
    // 防暑降温：应防暑降温，多饮水滋阴
    // 避免曝晒：避免过度曝晒，防范热伤元气
} else if (tiansi.contains("水")) {
    // 保暖防寒：注意保暖，防寒邪侵袭
    // 温阳补阳：勿过食生冷，适当温阳补阳
} else if (tiansi.contains("木")) {
    // 顺时调理：应顺时调理，防范肝阳上亢
    // 情绪平和：保持情绪平和，适当户外活动
} else if (tiansi.contains("土")) {
    // 健脾祛湿：健脾祛湿，少食甘肥厚腻
    // 促进代谢：适当运动，促进脾阳化湿
} else {  // 金
    // 滋阴润肺：滋阴润肺，防范咽喉干燥
    // 少刺激食：少食辛辣刺激，多食白色滋润食物
}
```

#### 5.2 下半年提示（在泉）

```java
if (zaiquan.contains("火")) {
    // 下半年炎热继续，需继续防暑
} else if (zaiquan.contains("水")) {
    // 下半年寒湿加重，需温阳祛湿
} else if (zaiquan.contains("木")) {
    // 下半年风邪仍盛，需继续调肝
} else if (zaiquan.contains("土")) {
    // 下半年湿气困脾，需健脾益气
} else {
    // 下半年燥气转盛，需继续润肺
}
```

### 六、实际案例：五运六气计算

#### 案例1：2024年（甲辰年）

**第一步：推算五运**
- 年份：2024 → 天干：甲
- 天干为甲 → 土运太过
- 解释：该年土行力量过盛，易脾胃湿滞

**第二步：推算司天在泉**
- 年份：2024 → mod 10 = 4
- mod 4对应：司天=太阳寒水，在泉=太阴湿土
- 解释：上半年寒冷潮湿，下半年继续湿气

**第三步：生成气候特征**
- 司天是水 → "上半年寒凉潮湿，易伤阳气"

**第四步：生成健康提示**
- 司天是水 → 上半年："注意保暖，防寒邪侵袭" 和 "勿过食生冷，适当温阳补阳"
- 在泉是土 → 下半年："下半年湿气困脾，需健脾益气"

**最终数据**：
```json
{
  "year": 2024,
  "transportation": "土运太过",
  "tiansi": "太阳寒水司天",
  "zaiquan": "太阴湿土在泉",
  "climate": "上半年寒凉潮湿，易伤阳气",
  "health_warnings": [
    "上半年注意保暖，防寒邪侵袭",
    "勿过食生冷，适当温阳补阳",
    "下半年湿气困脾，需健脾益气"
  ]
}
```

#### 案例2：2025年（乙巳年）

**推算过程**：
- 天干：乙 → 金运不及（该年易发呼吸道疾病）
- mod 5 → 司天=厥阴风木，在泉=少阴君火
- 气候：上半年风气主令，易动肝阳
- 提示：保持情绪平和，防范肝阳上亢；下半年炎热，需防暑

---

## 第二部分：体质判定系统

### 一、体质判定原理

体质判定基于**八字五行强弱分析**，遵循以下逻辑：
1. 统计八字中各五行的出现次数
2. 找出最强和最弱的五行
3. 根据对应关系推断体质类型

### 二、体质判定规则

#### 2.1 按最弱五行判定（优先级最高）

| 最弱五行 | 体质类型 | 原因 |
|---------|---------|------|
| **水** | **阴虚质** | 水主阴液，缺水导致阴液不足 |
| **火** | **阳虚质** | 火主阳气，缺火导致阳气虚弱 |

#### 2.2 按最强五行判定（当无最弱判定时）

| 最强五行 | 体质类型 | 原因 |
|---------|---------|------|
| **水** | **痰湿质** | 水湿过盛，脾阳不运，痰湿内生 |
| **木** | **气郁质** | 木气郁滞，情绪波动，气机不利 |
| **火** | **湿热质** | 火热与湿气相合，易生湿热 |

#### 2.3 五行均衡

- 所有五行数量均等 → **平和质**（最理想）

### 三、体质判定代码逻辑

```java
private String determineConstitution(EightChar eightChar, String gender) {
    // 步骤1：统计八字五行分布
    Map<String, Integer> wuxing = calculateWuxing(eightChar);
    
    // 步骤2：找出最强和最弱的五行
    int maxCount = Collections.max(wuxing.values());  // 最强的数量
    int minCount = Collections.min(wuxing.values());  // 最弱的数量
    
    String maxElement = wuxing.entrySet().stream()
        .filter(e -> e.getValue() == maxCount)
        .map(Map.Entry::getKey)
        .findFirst().orElse("");
    
    String minElement = wuxing.entrySet().stream()
        .filter(e -> e.getValue() == minCount)
        .map(Map.Entry::getKey)
        .findFirst().orElse("");
    
    // 步骤3：按规则判定体质
    // 规则1：最弱五行优先判定
    if (minElement.equals("水")) {
        return "阴虚质";  // 缺水=缺阴液
    } else if (minElement.equals("火")) {
        return "阳虚质";  // 缺火=缺阳气
    }
    // 规则2：最强五行次优先判定
    else if (maxElement.equals("水")) {
        return "痰湿质";  // 水过多=湿气过盛
    } else if (maxElement.equals("木")) {
        return "气郁质";  // 木过多=气机郁滞
    } else if (maxElement.equals("火")) {
        return "湿热质";  // 火过多=热与湿合
    }
    // 规则3：五行均衡
    else {
        return "平和质";  // 理想体质
    }
}
```

### 四、体质分类详解

#### 4.1 阴虚质（缺水）

**特征**：
- 口干、咽干、舌燥
- 皮肤干燥、易长痘
- 大便干结
- 手脚心热

**调理方向**：
- 增加黑色食物（黑木耳、黑豆、黑芝麻）
- 增加水类食物（冬瓜、海带、绿豆）
- 保证睡眠（阴长于夜）
- 避免熬夜、过度消耗

#### 4.2 阳虚质（缺火）

**特征**：
- 怕冷、四肢冰冷
- 面色苍白
- 大便溏软
- 精神不振

**调理方向**：
- 进补温阳食物（羊肉、生姜、桂圆）
- 避免冷食冷饮
- 适当运动（增加阳气）
- 温阳灸法（艾灸足三里）

#### 4.3 痰湿质（水过盛）

**特征**：
- 体型肥胖、腹部松软
- 容易困倦、嘴腻
- 大便粘滞不爽
- 舌苔厚腻

**调理方向**：
- 健脾祛湿（薏米、冬瓜、红豆）
- 少食甘肥厚腻
- 适当运动（增强脾阳）
- 定时进食（规律脾胃）

#### 4.4 气郁质（木过盛）

**特征**：
- 情绪不稳定、多思多虑
- 胸闷、喜欢叹气
- 乳房胀痛
- 月经不调

**调理方向**：
- 疏肝解郁（玫瑰花茶、陈皮）
- 适当户外活动（舒展气机）
- 调节情绪（瑜伽、冥想）
- 避免过度思虑

#### 4.5 湿热质（火过盛）

**特征**：
- 口苦、口腔溃疡
- 皮肤易长痘、瘙痒
- 大便粘滞、便秘
- 体味较重

**调理方向**：
- 清热祛湿（绿豆、冬瓜、薏米）
- 少食辛辣刺激
- 戒烟限酒
- 适当运动（排汗排湿）

#### 4.6 平和质（五行均衡）

**特征**：
- 精神充沛
- 面色润泽
- 大便正常
- 无明显偏差

**调理方向**：
- 维持现状（不需特殊调理）
- 均衡饮食
- 适度运动
- 作息规律

### 五、实际案例：体质判定

#### 案例：癸水日主（1991年12月16日）

**第一步：统计八字**
```
八字：辛未 庚子 癸未 己亥

天干：辛(金) 庚(金) 癸(水) 己(土) 
地支：未(土藏) 子(水) 未(土藏) 亥(水藏)

五行统计：
- 木：0
- 火：0
- 土：2个（来自两个未）
- 金：2个（辛、庚）
- 水：3个（癸、子、亥藏）
```

**第二步：分析五行强弱**
- 最强：水3个
- 次强：金2个、土2个
- 最弱：火0个、木0个

**第三步：判定体质**
- 最弱是"火"和"木"（都是0）→ 判定为**阳虚质**
- 原因：火虚弱导致阳气不足

**第四步：体质特征**
- 怕冷、四肢冰冷
- 大便溏软
- 精神不振
- 面色偏白

**第五步：调理建议**
- 进食温阳食物（羊肉、生姜、桂圆）
- 避免冷食冷饮
- 适当运动增加阳气
- 可进行温阳灸法

---

## 第三部分：联合应用

### 一、整体判断流程

```
输入：出生年月日时 → 
计算八字 → 
统计五行分布 →
判定体质 →
计算当年五运六气 →
生成年度健康建议
```

### 二、数据结构示例

```json
{
  "bazi": {
    "year": "辛未",
    "month": "庚子",
    "day": "癸未",
    "hour": "己亥"
  },
  "wuxing": {
    "木": 0,
    "火": 0,
    "土": 2,
    "金": 2,
    "水": 3
  },
  "constitution": "阳虚质",
  "analysis": {
    "cause": "八字中火行缺失，阳气虚弱",
    "symptom": "怕冷、四肢冰冷、大便溏软、精神不振",
    "tune": "进食温阳食物、避免冷饮、适度运动、温阳灸法"
  },
  "wuyunliuqi": {
    "year": 2024,
    "transportation": "土运太过",
    "tiansi": "太阳寒水司天",
    "zaiquan": "太阴湿土在泉",
    "climate": "上半年寒凉潮湿，易伤阳气",
    "health_warnings": [
      "上半年注意保暖，防寒邪侵袭",
      "勿过食生冷，适当温阳补阳",
      "下半年湿气困脾，需健脾益气"
    ]
  }
}
```

### 三、综合健康建议

结合体质和年度五运六气，给出个性化建议：

```
【你的体质】：阳虚质
【你的核心问题】：缺乏阳气

【今年(2024)的气候影响】：
- 该年为土运太过 + 上半年寒水司天
- 这对阳虚体质非常不利！
- 建议加强温阳，特别是上半年

【综合建议】：
1. 饮食温阳（生姜、羊肉、桂圆）
2. 避免生冷（特别是上半年）
3. 增加温阳灸法（艾灸足三里、三阴交）
4. 适度运动（特别是户外活动）
5. 规律作息（11点前入睡，阳气生长）

【禁忌】：
- 不要吹空调
- 不要喝冰水
- 不要冬天洗冷水澡
- 不要过度熬夜
```

---

## 常见问题解答

### Q1: 体质会改变吗？
**A**: 体质具有相对稳定性，但可通过调理改善。
- 短期（1-2月）：调理可改善症状
- 中期（3-6月）：可改变体质倾向
- 长期（1年以上）：可从一个体质转变为另一个

### Q2: 五运六气的预测准确率如何？
**A**: 五运六气反映的是**群体趋势**，而非个人准确预测。
- 准确率：约70-80%用于预测疾病高发趋势
- 应用：作为年度调理的参考，不能替代医疗诊断

### Q3: 我应该如何应对年度不利的五运六气？
**A**: 采用"预防大于治疗"策略：
- 提前1个月开始调理
- 加强对应的五行补充
- 增加相关的保健措施
- 定期复查调理效果

### Q4: 体质判定需要考虑性别吗？
**A**: 当前简化版不考虑，但标准版应该考虑：
- 女性：多补血和阴液（月经消耗）
- 男性：多补阳气和精力（工作消耗）
- 可在后续版本中完善

---

## 项目实现参考

### 后端计算流程

1. **八字计算** → BaziController.calculate()
2. **五行统计** → calculateWuxing()
3. **体质判定** → determineConstitution()
4. **五运六气** → calculateWuyunliuqi() / WuyunUtils
5. **调理建议** → generateAdvice() / AdviceGenerator
6. **数据保存** → PalmtreeDetail

### 前端展示位置

- **后台管理**：/frontend/src/views/palmtree/detail.vue
- **小程序**：/miniprogram/pages/palmtree/index.wxml
- **小程序结果页**：/miniprogram/pages/palmtree/result.wxml

---

**最后更新**：2025年12月5日  
**系统版本**：五行命盘系统 v1.0  
**适用范围**：中医健康管理系统
